/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => OneDrivePlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian2 = require("obsidian");

// onedrive-client.ts
var OneDriveClient = class {
  constructor(clientId, clientSecret, refreshToken) {
    this.clientId = clientId;
    this.clientSecret = clientSecret;
    this.refreshToken = refreshToken;
    this.accessToken = null;
    this.tokenExpiry = 0;
  }
  async initialize() {
    await this.authenticate();
  }
  async authenticate() {
    try {
      const response = await fetch("https://login.microsoftonline.com/common/oauth2/v2.0/token", {
        method: "POST",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded"
        },
        body: new URLSearchParams({
          client_id: this.clientId,
          client_secret: this.clientSecret,
          refresh_token: this.refreshToken,
          grant_type: "refresh_token",
          scope: "Files.ReadWrite.All offline_access"
        })
      });
      if (!response.ok) {
        throw new Error(`Authentication failed: ${response.statusText}`);
      }
      const data = await response.json();
      this.accessToken = data.access_token;
      this.tokenExpiry = Date.now() + data.expires_in * 1e3;
      if (data.refresh_token) {
        this.refreshToken = data.refresh_token;
      }
    } catch (error) {
      console.error("Authentication failed:", error);
      throw error;
    }
  }
  async ensureAuthenticated() {
    if (!this.accessToken || Date.now() >= this.tokenExpiry) {
      await this.authenticate();
    }
  }
  async listFiles(path = "/") {
    await this.ensureAuthenticated();
    try {
      const encodedPath = encodeURIComponent(path);
      const response = await fetch(
        `https://graph.microsoft.com/v1.0/me/drive/root:${encodedPath}:/children`,
        {
          headers: {
            "Authorization": `Bearer ${this.accessToken}`
          }
        }
      );
      if (!response.ok) {
        throw new Error(`Failed to list files: ${response.statusText}`);
      }
      const data = await response.json();
      return data.value;
    } catch (error) {
      console.error("Failed to list files:", error);
      throw error;
    }
  }
  async downloadFile(fileId) {
    await this.ensureAuthenticated();
    try {
      const response = await fetch(
        `https://graph.microsoft.com/v1.0/me/drive/items/${fileId}/content`,
        {
          headers: {
            "Authorization": `Bearer ${this.accessToken}`
          }
        }
      );
      if (!response.ok) {
        throw new Error(`Failed to download file: ${response.statusText}`);
      }
      return await response.arrayBuffer();
    } catch (error) {
      console.error("Failed to download file:", error);
      throw error;
    }
  }
  async uploadFile(path, content) {
    await this.ensureAuthenticated();
    try {
      const encodedPath = encodeURIComponent(path);
      const response = await fetch(
        `https://graph.microsoft.com/v1.0/me/drive/root:${encodedPath}:/content`,
        {
          method: "PUT",
          headers: {
            "Authorization": `Bearer ${this.accessToken}`,
            "Content-Type": "application/octet-stream"
          },
          body: content
        }
      );
      if (!response.ok) {
        throw new Error(`Failed to upload file: ${response.statusText}`);
      }
      return await response.json();
    } catch (error) {
      console.error("Failed to upload file:", error);
      throw error;
    }
  }
  async getFileMetadata(fileId) {
    await this.ensureAuthenticated();
    try {
      const response = await fetch(
        `https://graph.microsoft.com/v1.0/me/drive/items/${fileId}`,
        {
          headers: {
            "Authorization": `Bearer ${this.accessToken}`
          }
        }
      );
      if (!response.ok) {
        throw new Error(`Failed to get file metadata: ${response.statusText}`);
      }
      return await response.json();
    } catch (error) {
      console.error("Failed to get file metadata:", error);
      throw error;
    }
  }
};

// file-browser-modal.ts
var import_obsidian = require("obsidian");
var OneDriveFileModal = class extends import_obsidian.Modal {
  constructor(app, plugin) {
    super(app);
    this.plugin = plugin;
    this.currentPath = "/";
    this.items = [];
    this.breadcrumbs = ["/"];
  }
  async onOpen() {
    await this.loadCurrentFolder();
  }
  async loadCurrentFolder() {
    try {
      this.items = await this.plugin.client.listFiles(this.currentPath);
      this.display();
    } catch (error) {
      new import_obsidian.Notice("Failed to load OneDrive files");
      console.error("Error loading files:", error);
    }
  }
  display() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("onedrive-modal");
    const header = contentEl.createDiv("onedrive-modal-header");
    header.createEl("h2", { text: "OneDrive Files" });
    this.createBreadcrumbs(contentEl);
    const fileList = contentEl.createDiv("onedrive-file-list");
    if (this.currentPath !== "/") {
      const parentItem = fileList.createDiv("onedrive-file-item");
      (0, import_obsidian.setIcon)(parentItem.createDiv("onedrive-file-icon"), "folder");
      parentItem.createSpan({ text: ".." });
      parentItem.addEventListener("click", () => this.navigateUp());
    }
    const sortedItems = this.items.sort((a, b) => {
      const aIsFolder = !!a.folder;
      const bIsFolder = !!b.folder;
      if (aIsFolder && !bIsFolder) return -1;
      if (!aIsFolder && bIsFolder) return 1;
      return a.name.localeCompare(b.name);
    });
    for (const item of sortedItems) {
      const itemEl = fileList.createDiv("onedrive-file-item");
      const iconEl = itemEl.createDiv("onedrive-file-icon");
      (0, import_obsidian.setIcon)(iconEl, item.folder ? "folder" : "document");
      itemEl.createSpan({ text: item.name });
      if (!item.folder) {
        const metaEl = itemEl.createDiv("onedrive-file-meta");
        if (item.size) {
          metaEl.createSpan({
            text: this.formatSize(item.size),
            cls: "onedrive-file-size"
          });
        }
        if (item.lastModifiedDateTime) {
          metaEl.createSpan({
            text: new Date(item.lastModifiedDateTime).toLocaleDateString(),
            cls: "onedrive-file-date"
          });
        }
      }
      itemEl.addEventListener("click", () => {
        if (item.folder) {
          this.navigateToFolder(item.name);
        } else {
          this.handleFileClick(item);
        }
      });
    }
    this.addStyles();
  }
  createBreadcrumbs(containerEl) {
    const breadcrumbsEl = containerEl.createDiv("onedrive-breadcrumbs");
    let path = "";
    this.breadcrumbs.forEach((crumb, index) => {
      if (index > 0) {
        breadcrumbsEl.createSpan({ text: " > " });
      }
      path += index === 0 ? "" : "/" + crumb;
      const crumbEl = breadcrumbsEl.createSpan({
        text: crumb === "/" ? "Root" : crumb,
        cls: "onedrive-breadcrumb"
      });
      crumbEl.addEventListener("click", () => {
        this.navigateToPath(path || "/");
      });
    });
  }
  async navigateToFolder(folderName) {
    this.currentPath = this.currentPath === "/" ? `/${folderName}` : `${this.currentPath}/${folderName}`;
    this.breadcrumbs = ["/", ...this.currentPath.split("/").filter((p) => p)];
    await this.loadCurrentFolder();
  }
  async navigateUp() {
    const parts = this.currentPath.split("/").filter((p) => p);
    parts.pop();
    this.currentPath = parts.length === 0 ? "/" : "/" + parts.join("/");
    this.breadcrumbs.pop();
    await this.loadCurrentFolder();
  }
  async navigateToPath(path) {
    this.currentPath = path;
    this.breadcrumbs = ["/", ...path.split("/").filter((p) => p)];
    await this.loadCurrentFolder();
  }
  async handleFileClick(file) {
    try {
      const content = await this.plugin.client.downloadFile(file.id);
      const fileName = file.name.replace(/\.[^/.]+$/, "");
      await this.app.vault.create(`${fileName}.md`, new TextDecoder().decode(content));
      new import_obsidian.Notice(`File "${file.name}" imported successfully`);
    } catch (error) {
      new import_obsidian.Notice(`Failed to import file "${file.name}"`);
      console.error("Error importing file:", error);
    }
  }
  formatSize(bytes) {
    const units = ["B", "KB", "MB", "GB"];
    let size = bytes;
    let unitIndex = 0;
    while (size >= 1024 && unitIndex < units.length - 1) {
      size /= 1024;
      unitIndex++;
    }
    return `${size.toFixed(1)} ${units[unitIndex]}`;
  }
  addStyles() {
    document.head.appendChild(createEl("style", {
      attr: { type: "text/css" },
      text: `
                .onedrive-modal {
                    padding: 20px;
                }
                .onedrive-modal-header {
                    margin-bottom: 20px;
                }
                .onedrive-breadcrumbs {
                    margin-bottom: 15px;
                }
                .onedrive-breadcrumb {
                    cursor: pointer;
                    color: var(--text-muted);
                }
                .onedrive-breadcrumb:hover {
                    color: var(--text-normal);
                    text-decoration: underline;
                }
                .onedrive-file-list {
                    max-height: 400px;
                    overflow-y: auto;
                }
                .onedrive-file-item {
                    display: flex;
                    align-items: center;
                    padding: 8px;
                    cursor: pointer;
                    border-radius: 4px;
                }
                .onedrive-file-item:hover {
                    background-color: var(--background-secondary);
                }
                .onedrive-file-icon {
                    margin-right: 10px;
                }
                .onedrive-file-meta {
                    margin-left: auto;
                    color: var(--text-muted);
                    font-size: 0.8em;
                }
                .onedrive-file-size {
                    margin-right: 15px;
                }
            `
    }));
  }
};

// main.ts
var DEFAULT_SETTINGS = {
  clientId: "",
  clientSecret: "",
  refreshToken: "",
  syncInterval: 30
};
var OneDriveSettingTab = class extends import_obsidian2.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    new import_obsidian2.Setting(containerEl).setName("Client ID").setDesc("OneDrive application client ID").addText((text) => text.setPlaceholder("Enter client ID").setValue(this.plugin.settings.clientId).onChange(async (value) => {
      this.plugin.settings.clientId = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian2.Setting(containerEl).setName("Client Secret").setDesc("OneDrive application client secret").addText((text) => text.setPlaceholder("Enter client secret").setValue(this.plugin.settings.clientSecret).onChange(async (value) => {
      this.plugin.settings.clientSecret = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian2.Setting(containerEl).setName("Refresh Token").setDesc("OneDrive refresh token").addText((text) => text.setPlaceholder("Enter refresh token").setValue(this.plugin.settings.refreshToken).onChange(async (value) => {
      this.plugin.settings.refreshToken = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian2.Setting(containerEl).setName("Sync Interval").setDesc("How often to sync with OneDrive (in seconds)").addText((text) => text.setPlaceholder("30").setValue(String(this.plugin.settings.syncInterval)).onChange(async (value) => {
      this.plugin.settings.syncInterval = Number(value);
      await this.plugin.saveSettings();
    }));
  }
};
var OneDrivePlugin = class extends import_obsidian2.Plugin {
  async onload() {
    await this.loadSettings();
    this.client = new OneDriveClient(
      this.settings.clientId,
      this.settings.clientSecret,
      this.settings.refreshToken
    );
    try {
      await this.client.initialize();
      const files = await this.client.listFiles("/");
      console.log("Files in root:", files);
      new import_obsidian2.Notice("Successfully connected to OneDrive");
    } catch (error) {
      console.error("Failed to initialize OneDrive client:", error);
      new import_obsidian2.Notice("Failed to connect to OneDrive. Check your credentials.");
    }
    this.addSettingTab(new OneDriveSettingTab(this.app, this));
    this.addRibbonIcon("folder", "OneDrive Manager", async () => {
      try {
        await this.openFileBrowser();
      } catch (error) {
        console.error("Error opening file browser:", error);
        new import_obsidian2.Notice("Error opening OneDrive file browser");
      }
    });
    this.registerInterval(
      window.setInterval(async () => {
        try {
          await this.syncFiles();
        } catch (error) {
          console.error("Error during sync:", error);
          new import_obsidian2.Notice("OneDrive sync failed");
        }
      }, this.settings.syncInterval * 1e3)
    );
  }
  onunload() {
    console.log("Unloading OneDrive plugin");
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
  async syncFiles() {
    try {
      const files = await this.client.listFiles("/");
      console.log("Synced files:", files);
      new import_obsidian2.Notice(`Synced ${files.length} files from OneDrive`);
    } catch (error) {
      console.error("Sync failed:", error);
      new import_obsidian2.Notice("Failed to sync with OneDrive");
    }
  }
  async openFileBrowser() {
    const modal = new OneDriveFileModal(this.app, this);
    modal.open();
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyIsICJvbmVkcml2ZS1jbGllbnQudHMiLCAiZmlsZS1icm93c2VyLW1vZGFsLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgeyBBcHAsIFBsdWdpbiwgUGx1Z2luU2V0dGluZ1RhYiwgU2V0dGluZywgTm90aWNlIH0gZnJvbSAnb2JzaWRpYW4nO1xuaW1wb3J0IHsgT25lRHJpdmVDbGllbnQgfSBmcm9tICcuL29uZWRyaXZlLWNsaWVudCc7XG5pbXBvcnQgeyBPbmVEcml2ZUZpbGVNb2RhbCB9IGZyb20gJy4vZmlsZS1icm93c2VyLW1vZGFsJztcblxuaW50ZXJmYWNlIE9uZURyaXZlUGx1Z2luU2V0dGluZ3Mge1xuICAgIGNsaWVudElkOiBzdHJpbmc7XG4gICAgY2xpZW50U2VjcmV0OiBzdHJpbmc7XG4gICAgcmVmcmVzaFRva2VuOiBzdHJpbmc7XG4gICAgc3luY0ludGVydmFsOiBudW1iZXI7XG59XG5cbmNvbnN0IERFRkFVTFRfU0VUVElOR1M6IE9uZURyaXZlUGx1Z2luU2V0dGluZ3MgPSB7XG4gICAgY2xpZW50SWQ6ICcnLFxuICAgIGNsaWVudFNlY3JldDogJycsXG4gICAgcmVmcmVzaFRva2VuOiAnJyxcbiAgICBzeW5jSW50ZXJ2YWw6IDMwXG59XG5cbmNsYXNzIE9uZURyaXZlU2V0dGluZ1RhYiBleHRlbmRzIFBsdWdpblNldHRpbmdUYWIge1xuICAgIHBsdWdpbjogT25lRHJpdmVQbHVnaW47XG5cbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBPbmVEcml2ZVBsdWdpbikge1xuICAgICAgICBzdXBlcihhcHAsIHBsdWdpbik7XG4gICAgICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIH1cblxuICAgIGRpc3BsYXkoKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHtjb250YWluZXJFbH0gPSB0aGlzO1xuICAgICAgICBjb250YWluZXJFbC5lbXB0eSgpO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoJ0NsaWVudCBJRCcpXG4gICAgICAgICAgICAuc2V0RGVzYygnT25lRHJpdmUgYXBwbGljYXRpb24gY2xpZW50IElEJylcbiAgICAgICAgICAgIC5hZGRUZXh0KHRleHQgPT4gdGV4dFxuICAgICAgICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcignRW50ZXIgY2xpZW50IElEJylcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuY2xpZW50SWQpXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5jbGllbnRJZCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KSk7XG5cbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgICAuc2V0TmFtZSgnQ2xpZW50IFNlY3JldCcpXG4gICAgICAgICAgICAuc2V0RGVzYygnT25lRHJpdmUgYXBwbGljYXRpb24gY2xpZW50IHNlY3JldCcpXG4gICAgICAgICAgICAuYWRkVGV4dCh0ZXh0ID0+IHRleHRcbiAgICAgICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ0VudGVyIGNsaWVudCBzZWNyZXQnKVxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5jbGllbnRTZWNyZXQpXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5jbGllbnRTZWNyZXQgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoJ1JlZnJlc2ggVG9rZW4nKVxuICAgICAgICAgICAgLnNldERlc2MoJ09uZURyaXZlIHJlZnJlc2ggdG9rZW4nKVxuICAgICAgICAgICAgLmFkZFRleHQodGV4dCA9PiB0ZXh0XG4gICAgICAgICAgICAgICAgLnNldFBsYWNlaG9sZGVyKCdFbnRlciByZWZyZXNoIHRva2VuJylcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MucmVmcmVzaFRva2VuKVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MucmVmcmVzaFRva2VuID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pKTtcblxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKCdTeW5jIEludGVydmFsJylcbiAgICAgICAgICAgIC5zZXREZXNjKCdIb3cgb2Z0ZW4gdG8gc3luYyB3aXRoIE9uZURyaXZlIChpbiBzZWNvbmRzKScpXG4gICAgICAgICAgICAuYWRkVGV4dCh0ZXh0ID0+IHRleHRcbiAgICAgICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJzMwJylcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUoU3RyaW5nKHRoaXMucGx1Z2luLnNldHRpbmdzLnN5bmNJbnRlcnZhbCkpXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zeW5jSW50ZXJ2YWwgPSBOdW1iZXIodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBPbmVEcml2ZVBsdWdpbiBleHRlbmRzIFBsdWdpbiB7XG4gICAgc2V0dGluZ3M6IE9uZURyaXZlUGx1Z2luU2V0dGluZ3M7XG4gICAgY2xpZW50OiBPbmVEcml2ZUNsaWVudDtcblxuICAgIGFzeW5jIG9ubG9hZCgpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5sb2FkU2V0dGluZ3MoKTtcblxuICAgICAgICAvLyBJbml0aWFsaXplIE9uZURyaXZlIGNsaWVudFxuICAgICAgICB0aGlzLmNsaWVudCA9IG5ldyBPbmVEcml2ZUNsaWVudChcbiAgICAgICAgICAgIHRoaXMuc2V0dGluZ3MuY2xpZW50SWQsXG4gICAgICAgICAgICB0aGlzLnNldHRpbmdzLmNsaWVudFNlY3JldCxcbiAgICAgICAgICAgIHRoaXMuc2V0dGluZ3MucmVmcmVzaFRva2VuXG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gVGVzdCBPbmVEcml2ZSBjb25uZWN0aW9uIGFuZCBsaXN0IGZpbGVzXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmNsaWVudC5pbml0aWFsaXplKCk7XG4gICAgICAgICAgICBjb25zdCBmaWxlcyA9IGF3YWl0IHRoaXMuY2xpZW50Lmxpc3RGaWxlcygnLycpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0ZpbGVzIGluIHJvb3Q6JywgZmlsZXMpO1xuICAgICAgICAgICAgbmV3IE5vdGljZSgnU3VjY2Vzc2Z1bGx5IGNvbm5lY3RlZCB0byBPbmVEcml2ZScpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGluaXRpYWxpemUgT25lRHJpdmUgY2xpZW50OicsIGVycm9yKTtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoJ0ZhaWxlZCB0byBjb25uZWN0IHRvIE9uZURyaXZlLiBDaGVjayB5b3VyIGNyZWRlbnRpYWxzLicpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQWRkIHNldHRpbmdzIHRhYlxuICAgICAgICB0aGlzLmFkZFNldHRpbmdUYWIobmV3IE9uZURyaXZlU2V0dGluZ1RhYih0aGlzLmFwcCwgdGhpcykpO1xuXG4gICAgICAgIC8vIEFkZCByaWJib24gaWNvblxuICAgICAgICB0aGlzLmFkZFJpYmJvbkljb24oJ2ZvbGRlcicsICdPbmVEcml2ZSBNYW5hZ2VyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLm9wZW5GaWxlQnJvd3NlcigpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBvcGVuaW5nIGZpbGUgYnJvd3NlcjonLCBlcnJvcik7XG4gICAgICAgICAgICAgICAgbmV3IE5vdGljZSgnRXJyb3Igb3BlbmluZyBPbmVEcml2ZSBmaWxlIGJyb3dzZXInKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gUmVnaXN0ZXIgZmlsZSBzeW5jIGludGVydmFsXG4gICAgICAgIHRoaXMucmVnaXN0ZXJJbnRlcnZhbChcbiAgICAgICAgICAgIHdpbmRvdy5zZXRJbnRlcnZhbChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5zeW5jRmlsZXMoKTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkdXJpbmcgc3luYzonLCBlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoJ09uZURyaXZlIHN5bmMgZmFpbGVkJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgdGhpcy5zZXR0aW5ncy5zeW5jSW50ZXJ2YWwgKiAxMDAwKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIG9udW5sb2FkKCkge1xuICAgICAgICBjb25zb2xlLmxvZygnVW5sb2FkaW5nIE9uZURyaXZlIHBsdWdpbicpO1xuICAgIH1cblxuICAgIGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcbiAgICAgICAgdGhpcy5zZXR0aW5ncyA9IE9iamVjdC5hc3NpZ24oe30sIERFRkFVTFRfU0VUVElOR1MsIGF3YWl0IHRoaXMubG9hZERhdGEoKSk7XG4gICAgfVxuXG4gICAgYXN5bmMgc2F2ZVNldHRpbmdzKCkge1xuICAgICAgICBhd2FpdCB0aGlzLnNhdmVEYXRhKHRoaXMuc2V0dGluZ3MpO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgc3luY0ZpbGVzKCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgZmlsZXMgPSBhd2FpdCB0aGlzLmNsaWVudC5saXN0RmlsZXMoJy8nKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTeW5jZWQgZmlsZXM6JywgZmlsZXMpO1xuICAgICAgICAgICAgLy8gVE9ETzogSW1wbGVtZW50IGZ1bGwgc3luYyBsb2dpY1xuICAgICAgICAgICAgbmV3IE5vdGljZShgU3luY2VkICR7ZmlsZXMubGVuZ3RofSBmaWxlcyBmcm9tIE9uZURyaXZlYCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdTeW5jIGZhaWxlZDonLCBlcnJvcik7XG4gICAgICAgICAgICBuZXcgTm90aWNlKCdGYWlsZWQgdG8gc3luYyB3aXRoIE9uZURyaXZlJyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIG9wZW5GaWxlQnJvd3NlcigpIHtcbiAgICAgICAgY29uc3QgbW9kYWwgPSBuZXcgT25lRHJpdmVGaWxlTW9kYWwodGhpcy5hcHAsIHRoaXMpO1xuICAgICAgICBtb2RhbC5vcGVuKCk7XG4gICAgfVxufSIsICJleHBvcnQgY2xhc3MgT25lRHJpdmVDbGllbnQge1xuICAgIHByaXZhdGUgYWNjZXNzVG9rZW46IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICAgIHByaXZhdGUgdG9rZW5FeHBpcnk6IG51bWJlciA9IDA7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNsaWVudElkOiBzdHJpbmcsIHByaXZhdGUgY2xpZW50U2VjcmV0OiBzdHJpbmcsIHByaXZhdGUgcmVmcmVzaFRva2VuOiBzdHJpbmcpIHt9XG5cbiAgICBhc3luYyBpbml0aWFsaXplKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBhd2FpdCB0aGlzLmF1dGhlbnRpY2F0ZSgpO1xuICAgIH1cblxuICAgIGFzeW5jIGF1dGhlbnRpY2F0ZSgpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJ2h0dHBzOi8vbG9naW4ubWljcm9zb2Z0b25saW5lLmNvbS9jb21tb24vb2F1dGgyL3YyLjAvdG9rZW4nLCB7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCdcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGJvZHk6IG5ldyBVUkxTZWFyY2hQYXJhbXMoe1xuICAgICAgICAgICAgICAgICAgICBjbGllbnRfaWQ6IHRoaXMuY2xpZW50SWQsXG4gICAgICAgICAgICAgICAgICAgIGNsaWVudF9zZWNyZXQ6IHRoaXMuY2xpZW50U2VjcmV0LFxuICAgICAgICAgICAgICAgICAgICByZWZyZXNoX3Rva2VuOiB0aGlzLnJlZnJlc2hUb2tlbixcbiAgICAgICAgICAgICAgICAgICAgZ3JhbnRfdHlwZTogJ3JlZnJlc2hfdG9rZW4nLFxuICAgICAgICAgICAgICAgICAgICBzY29wZTogJ0ZpbGVzLlJlYWRXcml0ZS5BbGwgb2ZmbGluZV9hY2Nlc3MnXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBBdXRoZW50aWNhdGlvbiBmYWlsZWQ6ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgIHRoaXMuYWNjZXNzVG9rZW4gPSBkYXRhLmFjY2Vzc190b2tlbjtcbiAgICAgICAgICAgIHRoaXMudG9rZW5FeHBpcnkgPSBEYXRlLm5vdygpICsgKGRhdGEuZXhwaXJlc19pbiAqIDEwMDApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBTdG9yZSB0aGUgbmV3IHJlZnJlc2ggdG9rZW4gaWYgcHJvdmlkZWRcbiAgICAgICAgICAgIGlmIChkYXRhLnJlZnJlc2hfdG9rZW4pIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlZnJlc2hUb2tlbiA9IGRhdGEucmVmcmVzaF90b2tlbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0F1dGhlbnRpY2F0aW9uIGZhaWxlZDonLCBlcnJvcik7XG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgZW5zdXJlQXV0aGVudGljYXRlZCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgaWYgKCF0aGlzLmFjY2Vzc1Rva2VuIHx8IERhdGUubm93KCkgPj0gdGhpcy50b2tlbkV4cGlyeSkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5hdXRoZW50aWNhdGUoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIGxpc3RGaWxlcyhwYXRoOiBzdHJpbmcgPSAnLycpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5lbnN1cmVBdXRoZW50aWNhdGVkKCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBlbmNvZGVkUGF0aCA9IGVuY29kZVVSSUNvbXBvbmVudChwYXRoKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXG4gICAgICAgICAgICAgICAgYGh0dHBzOi8vZ3JhcGgubWljcm9zb2Z0LmNvbS92MS4wL21lL2RyaXZlL3Jvb3Q6JHtlbmNvZGVkUGF0aH06L2NoaWxkcmVuYCwge1xuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7dGhpcy5hY2Nlc3NUb2tlbn1gXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBsaXN0IGZpbGVzOiAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgICByZXR1cm4gZGF0YS52YWx1ZTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBsaXN0IGZpbGVzOicsIGVycm9yKTtcbiAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXN5bmMgZG93bmxvYWRGaWxlKGZpbGVJZDogc3RyaW5nKTogUHJvbWlzZTxBcnJheUJ1ZmZlcj4ge1xuICAgICAgICBhd2FpdCB0aGlzLmVuc3VyZUF1dGhlbnRpY2F0ZWQoKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXG4gICAgICAgICAgICAgICAgYGh0dHBzOi8vZ3JhcGgubWljcm9zb2Z0LmNvbS92MS4wL21lL2RyaXZlL2l0ZW1zLyR7ZmlsZUlkfS9jb250ZW50YCwge1xuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7dGhpcy5hY2Nlc3NUb2tlbn1gXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBkb3dubG9hZCBmaWxlOiAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXNwb25zZS5hcnJheUJ1ZmZlcigpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGRvd25sb2FkIGZpbGU6JywgZXJyb3IpO1xuICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyB1cGxvYWRGaWxlKHBhdGg6IHN0cmluZywgY29udGVudDogQXJyYXlCdWZmZXIpOiBQcm9taXNlPGFueT4ge1xuICAgICAgICBhd2FpdCB0aGlzLmVuc3VyZUF1dGhlbnRpY2F0ZWQoKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGVuY29kZWRQYXRoID0gZW5jb2RlVVJJQ29tcG9uZW50KHBhdGgpO1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcbiAgICAgICAgICAgICAgICBgaHR0cHM6Ly9ncmFwaC5taWNyb3NvZnQuY29tL3YxLjAvbWUvZHJpdmUvcm9vdDoke2VuY29kZWRQYXRofTovY29udGVudGAsIHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQVVQnLFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7dGhpcy5hY2Nlc3NUb2tlbn1gLFxuICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSdcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGJvZHk6IGNvbnRlbnRcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gdXBsb2FkIGZpbGU6ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byB1cGxvYWQgZmlsZTonLCBlcnJvcik7XG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIGdldEZpbGVNZXRhZGF0YShmaWxlSWQ6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XG4gICAgICAgIGF3YWl0IHRoaXMuZW5zdXJlQXV0aGVudGljYXRlZCgpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcbiAgICAgICAgICAgICAgICBgaHR0cHM6Ly9ncmFwaC5taWNyb3NvZnQuY29tL3YxLjAvbWUvZHJpdmUvaXRlbXMvJHtmaWxlSWR9YCwge1xuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7dGhpcy5hY2Nlc3NUb2tlbn1gXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBnZXQgZmlsZSBtZXRhZGF0YTogJHtyZXNwb25zZS5zdGF0dXNUZXh0fWApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGdldCBmaWxlIG1ldGFkYXRhOicsIGVycm9yKTtcbiAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9XG4gICAgfVxufSIsICJpbXBvcnQgeyBBcHAsIE1vZGFsLCBURmlsZSwgTm90aWNlLCBzZXRJY29uIH0gZnJvbSAnb2JzaWRpYW4nO1xuaW1wb3J0IE9uZURyaXZlUGx1Z2luIGZyb20gJy4vbWFpbic7XG5cbmludGVyZmFjZSBPbmVEcml2ZUl0ZW0ge1xuICAgIGlkOiBzdHJpbmc7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIGZvbGRlcj86IHsgY2hpbGRDb3VudDogbnVtYmVyIH07XG4gICAgc2l6ZT86IG51bWJlcjtcbiAgICBsYXN0TW9kaWZpZWREYXRlVGltZT86IHN0cmluZztcbn1cblxuZXhwb3J0IGNsYXNzIE9uZURyaXZlRmlsZU1vZGFsIGV4dGVuZHMgTW9kYWwge1xuICAgIHByaXZhdGUgY3VycmVudFBhdGg6IHN0cmluZyA9ICcvJztcbiAgICBwcml2YXRlIGl0ZW1zOiBPbmVEcml2ZUl0ZW1bXSA9IFtdO1xuICAgIHByaXZhdGUgYnJlYWRjcnVtYnM6IHN0cmluZ1tdID0gWycvJ107XG5cbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcHJpdmF0ZSBwbHVnaW46IE9uZURyaXZlUGx1Z2luKSB7XG4gICAgICAgIHN1cGVyKGFwcCk7XG4gICAgfVxuXG4gICAgYXN5bmMgb25PcGVuKCkge1xuICAgICAgICBhd2FpdCB0aGlzLmxvYWRDdXJyZW50Rm9sZGVyKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBsb2FkQ3VycmVudEZvbGRlcigpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMuaXRlbXMgPSBhd2FpdCB0aGlzLnBsdWdpbi5jbGllbnQubGlzdEZpbGVzKHRoaXMuY3VycmVudFBhdGgpO1xuICAgICAgICAgICAgdGhpcy5kaXNwbGF5KCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBuZXcgTm90aWNlKCdGYWlsZWQgdG8gbG9hZCBPbmVEcml2ZSBmaWxlcycpO1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgbG9hZGluZyBmaWxlczonLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGRpc3BsYXkoKSB7XG4gICAgICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgICAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgICAgICAgY29udGVudEVsLmFkZENsYXNzKCdvbmVkcml2ZS1tb2RhbCcpO1xuXG4gICAgICAgIC8vIEFkZCBoZWFkZXJcbiAgICAgICAgY29uc3QgaGVhZGVyID0gY29udGVudEVsLmNyZWF0ZURpdignb25lZHJpdmUtbW9kYWwtaGVhZGVyJyk7XG4gICAgICAgIGhlYWRlci5jcmVhdGVFbCgnaDInLCB7IHRleHQ6ICdPbmVEcml2ZSBGaWxlcycgfSk7XG5cbiAgICAgICAgLy8gQWRkIGJyZWFkY3J1bWJzXG4gICAgICAgIHRoaXMuY3JlYXRlQnJlYWRjcnVtYnMoY29udGVudEVsKTtcblxuICAgICAgICAvLyBBZGQgZmlsZSBsaXN0XG4gICAgICAgIGNvbnN0IGZpbGVMaXN0ID0gY29udGVudEVsLmNyZWF0ZURpdignb25lZHJpdmUtZmlsZS1saXN0Jyk7XG4gICAgICAgIFxuICAgICAgICAvLyBBZGQgcGFyZW50IGRpcmVjdG9yeSBvcHRpb24gaWYgbm90IGluIHJvb3RcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudFBhdGggIT09ICcvJykge1xuICAgICAgICAgICAgY29uc3QgcGFyZW50SXRlbSA9IGZpbGVMaXN0LmNyZWF0ZURpdignb25lZHJpdmUtZmlsZS1pdGVtJyk7XG4gICAgICAgICAgICBzZXRJY29uKHBhcmVudEl0ZW0uY3JlYXRlRGl2KCdvbmVkcml2ZS1maWxlLWljb24nKSwgJ2ZvbGRlcicpO1xuICAgICAgICAgICAgcGFyZW50SXRlbS5jcmVhdGVTcGFuKHsgdGV4dDogJy4uJyB9KTtcbiAgICAgICAgICAgIHBhcmVudEl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB0aGlzLm5hdmlnYXRlVXAoKSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTb3J0IGl0ZW1zOiBmb2xkZXJzIGZpcnN0LCB0aGVuIGZpbGVzXG4gICAgICAgIGNvbnN0IHNvcnRlZEl0ZW1zID0gdGhpcy5pdGVtcy5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBhSXNGb2xkZXIgPSAhIWEuZm9sZGVyO1xuICAgICAgICAgICAgY29uc3QgYklzRm9sZGVyID0gISFiLmZvbGRlcjtcbiAgICAgICAgICAgIGlmIChhSXNGb2xkZXIgJiYgIWJJc0ZvbGRlcikgcmV0dXJuIC0xO1xuICAgICAgICAgICAgaWYgKCFhSXNGb2xkZXIgJiYgYklzRm9sZGVyKSByZXR1cm4gMTtcbiAgICAgICAgICAgIHJldHVybiBhLm5hbWUubG9jYWxlQ29tcGFyZShiLm5hbWUpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBBZGQgaXRlbXNcbiAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIHNvcnRlZEl0ZW1zKSB7XG4gICAgICAgICAgICBjb25zdCBpdGVtRWwgPSBmaWxlTGlzdC5jcmVhdGVEaXYoJ29uZWRyaXZlLWZpbGUtaXRlbScpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBJY29uXG4gICAgICAgICAgICBjb25zdCBpY29uRWwgPSBpdGVtRWwuY3JlYXRlRGl2KCdvbmVkcml2ZS1maWxlLWljb24nKTtcbiAgICAgICAgICAgIHNldEljb24oaWNvbkVsLCBpdGVtLmZvbGRlciA/ICdmb2xkZXInIDogJ2RvY3VtZW50Jyk7XG5cbiAgICAgICAgICAgIC8vIE5hbWVcbiAgICAgICAgICAgIGl0ZW1FbC5jcmVhdGVTcGFuKHsgdGV4dDogaXRlbS5uYW1lIH0pO1xuXG4gICAgICAgICAgICAvLyBTaXplIGFuZCBkYXRlIGZvciBmaWxlc1xuICAgICAgICAgICAgaWYgKCFpdGVtLmZvbGRlcikge1xuICAgICAgICAgICAgICAgIGNvbnN0IG1ldGFFbCA9IGl0ZW1FbC5jcmVhdGVEaXYoJ29uZWRyaXZlLWZpbGUtbWV0YScpO1xuICAgICAgICAgICAgICAgIGlmIChpdGVtLnNpemUpIHtcbiAgICAgICAgICAgICAgICAgICAgbWV0YUVsLmNyZWF0ZVNwYW4oeyBcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMuZm9ybWF0U2l6ZShpdGVtLnNpemUpLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2xzOiAnb25lZHJpdmUtZmlsZS1zaXplJ1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0ubGFzdE1vZGlmaWVkRGF0ZVRpbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgbWV0YUVsLmNyZWF0ZVNwYW4oeyBcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IG5ldyBEYXRlKGl0ZW0ubGFzdE1vZGlmaWVkRGF0ZVRpbWUpLnRvTG9jYWxlRGF0ZVN0cmluZygpLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2xzOiAnb25lZHJpdmUtZmlsZS1kYXRlJ1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIENsaWNrIGhhbmRsZXJcbiAgICAgICAgICAgIGl0ZW1FbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5mb2xkZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5uYXZpZ2F0ZVRvRm9sZGVyKGl0ZW0ubmFtZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVGaWxlQ2xpY2soaXRlbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBZGQgc3R5bGVzXG4gICAgICAgIHRoaXMuYWRkU3R5bGVzKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjcmVhdGVCcmVhZGNydW1icyhjb250YWluZXJFbDogSFRNTEVsZW1lbnQpIHtcbiAgICAgICAgY29uc3QgYnJlYWRjcnVtYnNFbCA9IGNvbnRhaW5lckVsLmNyZWF0ZURpdignb25lZHJpdmUtYnJlYWRjcnVtYnMnKTtcbiAgICAgICAgbGV0IHBhdGggPSAnJztcbiAgICAgICAgXG4gICAgICAgIHRoaXMuYnJlYWRjcnVtYnMuZm9yRWFjaCgoY3J1bWIsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICBpZiAoaW5kZXggPiAwKSB7XG4gICAgICAgICAgICAgICAgYnJlYWRjcnVtYnNFbC5jcmVhdGVTcGFuKHsgdGV4dDogJyA+ICcgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHBhdGggKz0gaW5kZXggPT09IDAgPyAnJyA6ICcvJyArIGNydW1iO1xuICAgICAgICAgICAgY29uc3QgY3J1bWJFbCA9IGJyZWFkY3J1bWJzRWwuY3JlYXRlU3Bhbih7XG4gICAgICAgICAgICAgICAgdGV4dDogY3J1bWIgPT09ICcvJyA/ICdSb290JyA6IGNydW1iLFxuICAgICAgICAgICAgICAgIGNsczogJ29uZWRyaXZlLWJyZWFkY3J1bWInXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY3J1bWJFbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLm5hdmlnYXRlVG9QYXRoKHBhdGggfHwgJy8nKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIG5hdmlnYXRlVG9Gb2xkZXIoZm9sZGVyTmFtZTogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuY3VycmVudFBhdGggPSB0aGlzLmN1cnJlbnRQYXRoID09PSAnLycgXG4gICAgICAgICAgICA/IGAvJHtmb2xkZXJOYW1lfWBcbiAgICAgICAgICAgIDogYCR7dGhpcy5jdXJyZW50UGF0aH0vJHtmb2xkZXJOYW1lfWA7XG4gICAgICAgIHRoaXMuYnJlYWRjcnVtYnMgPSBbJy8nLCAuLi50aGlzLmN1cnJlbnRQYXRoLnNwbGl0KCcvJykuZmlsdGVyKHAgPT4gcCldO1xuICAgICAgICBhd2FpdCB0aGlzLmxvYWRDdXJyZW50Rm9sZGVyKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBuYXZpZ2F0ZVVwKCkge1xuICAgICAgICBjb25zdCBwYXJ0cyA9IHRoaXMuY3VycmVudFBhdGguc3BsaXQoJy8nKS5maWx0ZXIocCA9PiBwKTtcbiAgICAgICAgcGFydHMucG9wKCk7XG4gICAgICAgIHRoaXMuY3VycmVudFBhdGggPSBwYXJ0cy5sZW5ndGggPT09IDAgPyAnLycgOiAnLycgKyBwYXJ0cy5qb2luKCcvJyk7XG4gICAgICAgIHRoaXMuYnJlYWRjcnVtYnMucG9wKCk7XG4gICAgICAgIGF3YWl0IHRoaXMubG9hZEN1cnJlbnRGb2xkZXIoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIG5hdmlnYXRlVG9QYXRoKHBhdGg6IHN0cmluZykge1xuICAgICAgICB0aGlzLmN1cnJlbnRQYXRoID0gcGF0aDtcbiAgICAgICAgdGhpcy5icmVhZGNydW1icyA9IFsnLycsIC4uLnBhdGguc3BsaXQoJy8nKS5maWx0ZXIocCA9PiBwKV07XG4gICAgICAgIGF3YWl0IHRoaXMubG9hZEN1cnJlbnRGb2xkZXIoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIGhhbmRsZUZpbGVDbGljayhmaWxlOiBPbmVEcml2ZUl0ZW0pIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLnBsdWdpbi5jbGllbnQuZG93bmxvYWRGaWxlKGZpbGUuaWQpO1xuICAgICAgICAgICAgLy8gQ3JlYXRlIGEgbmV3IG5vdGUgd2l0aCB0aGUgZmlsZSBjb250ZW50XG4gICAgICAgICAgICBjb25zdCBmaWxlTmFtZSA9IGZpbGUubmFtZS5yZXBsYWNlKC9cXC5bXi8uXSskLywgJycpOyAvLyBSZW1vdmUgZXh0ZW5zaW9uXG4gICAgICAgICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGUoYCR7ZmlsZU5hbWV9Lm1kYCwgbmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKGNvbnRlbnQpKTtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoYEZpbGUgXCIke2ZpbGUubmFtZX1cIiBpbXBvcnRlZCBzdWNjZXNzZnVsbHlgKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoYEZhaWxlZCB0byBpbXBvcnQgZmlsZSBcIiR7ZmlsZS5uYW1lfVwiYCk7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbXBvcnRpbmcgZmlsZTonLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGZvcm1hdFNpemUoYnl0ZXM6IG51bWJlcik6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IHVuaXRzID0gWydCJywgJ0tCJywgJ01CJywgJ0dCJ107XG4gICAgICAgIGxldCBzaXplID0gYnl0ZXM7XG4gICAgICAgIGxldCB1bml0SW5kZXggPSAwO1xuICAgICAgICBcbiAgICAgICAgd2hpbGUgKHNpemUgPj0gMTAyNCAmJiB1bml0SW5kZXggPCB1bml0cy5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICBzaXplIC89IDEwMjQ7XG4gICAgICAgICAgICB1bml0SW5kZXgrKztcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGAke3NpemUudG9GaXhlZCgxKX0gJHt1bml0c1t1bml0SW5kZXhdfWA7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhZGRTdHlsZXMoKSB7XG4gICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoY3JlYXRlRWwoJ3N0eWxlJywge1xuICAgICAgICAgICAgYXR0cjogeyB0eXBlOiAndGV4dC9jc3MnIH0sXG4gICAgICAgICAgICB0ZXh0OiBgXG4gICAgICAgICAgICAgICAgLm9uZWRyaXZlLW1vZGFsIHtcbiAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogMjBweDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLm9uZWRyaXZlLW1vZGFsLWhlYWRlciB7XG4gICAgICAgICAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDIwcHg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC5vbmVkcml2ZS1icmVhZGNydW1icyB7XG4gICAgICAgICAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDE1cHg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC5vbmVkcml2ZS1icmVhZGNydW1iIHtcbiAgICAgICAgICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyO1xuICAgICAgICAgICAgICAgICAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC5vbmVkcml2ZS1icmVhZGNydW1iOmhvdmVyIHtcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6IHZhcigtLXRleHQtbm9ybWFsKTtcbiAgICAgICAgICAgICAgICAgICAgdGV4dC1kZWNvcmF0aW9uOiB1bmRlcmxpbmU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC5vbmVkcml2ZS1maWxlLWxpc3Qge1xuICAgICAgICAgICAgICAgICAgICBtYXgtaGVpZ2h0OiA0MDBweDtcbiAgICAgICAgICAgICAgICAgICAgb3ZlcmZsb3cteTogYXV0bztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLm9uZWRyaXZlLWZpbGUtaXRlbSB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICAgICAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gICAgICAgICAgICAgICAgICAgIHBhZGRpbmc6IDhweDtcbiAgICAgICAgICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyO1xuICAgICAgICAgICAgICAgICAgICBib3JkZXItcmFkaXVzOiA0cHg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC5vbmVkcml2ZS1maWxlLWl0ZW06aG92ZXIge1xuICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1iYWNrZ3JvdW5kLXNlY29uZGFyeSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC5vbmVkcml2ZS1maWxlLWljb24ge1xuICAgICAgICAgICAgICAgICAgICBtYXJnaW4tcmlnaHQ6IDEwcHg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC5vbmVkcml2ZS1maWxlLW1ldGEge1xuICAgICAgICAgICAgICAgICAgICBtYXJnaW4tbGVmdDogYXV0bztcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpO1xuICAgICAgICAgICAgICAgICAgICBmb250LXNpemU6IDAuOGVtO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAub25lZHJpdmUtZmlsZS1zaXplIHtcbiAgICAgICAgICAgICAgICAgICAgbWFyZ2luLXJpZ2h0OiAxNXB4O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGBcbiAgICAgICAgfSkpO1xuICAgIH1cbn0iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsSUFBQUEsbUJBQStEOzs7QUNBeEQsSUFBTSxpQkFBTixNQUFxQjtBQUFBLEVBSXhCLFlBQW9CLFVBQTBCLGNBQThCLGNBQXNCO0FBQTlFO0FBQTBCO0FBQThCO0FBSDVFLFNBQVEsY0FBNkI7QUFDckMsU0FBUSxjQUFzQjtBQUFBLEVBRXFFO0FBQUEsRUFFbkcsTUFBTSxhQUE0QjtBQUM5QixVQUFNLEtBQUssYUFBYTtBQUFBLEVBQzVCO0FBQUEsRUFFQSxNQUFNLGVBQWU7QUFDakIsUUFBSTtBQUNBLFlBQU0sV0FBVyxNQUFNLE1BQU0sOERBQThEO0FBQUEsUUFDdkYsUUFBUTtBQUFBLFFBQ1IsU0FBUztBQUFBLFVBQ0wsZ0JBQWdCO0FBQUEsUUFDcEI7QUFBQSxRQUNBLE1BQU0sSUFBSSxnQkFBZ0I7QUFBQSxVQUN0QixXQUFXLEtBQUs7QUFBQSxVQUNoQixlQUFlLEtBQUs7QUFBQSxVQUNwQixlQUFlLEtBQUs7QUFBQSxVQUNwQixZQUFZO0FBQUEsVUFDWixPQUFPO0FBQUEsUUFDWCxDQUFDO0FBQUEsTUFDTCxDQUFDO0FBRUQsVUFBSSxDQUFDLFNBQVMsSUFBSTtBQUNkLGNBQU0sSUFBSSxNQUFNLDBCQUEwQixTQUFTLFVBQVUsRUFBRTtBQUFBLE1BQ25FO0FBRUEsWUFBTSxPQUFPLE1BQU0sU0FBUyxLQUFLO0FBQ2pDLFdBQUssY0FBYyxLQUFLO0FBQ3hCLFdBQUssY0FBYyxLQUFLLElBQUksSUFBSyxLQUFLLGFBQWE7QUFHbkQsVUFBSSxLQUFLLGVBQWU7QUFDcEIsYUFBSyxlQUFlLEtBQUs7QUFBQSxNQUM3QjtBQUFBLElBQ0osU0FBUyxPQUFPO0FBQ1osY0FBUSxNQUFNLDBCQUEwQixLQUFLO0FBQzdDLFlBQU07QUFBQSxJQUNWO0FBQUEsRUFDSjtBQUFB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
